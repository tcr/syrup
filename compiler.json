[
  [
    "=",
    "chunker",
    [
      "combine",
      [
        [
          "quote",
          "leftbracket"
        ],
        [
          "regex",
          [
            "quote",
            "^\\["
          ]
        ]
      ],
      [
        [
          "quote",
          "rightbracket"
        ],
        [
          "regex",
          [
            "quote",
            "^\\]"
          ]
        ]
      ],
      [
        [
          "quote",
          "leftparen"
        ],
        [
          "regex",
          [
            "quote",
            "^\\("
          ]
        ]
      ],
      [
        [
          "quote",
          "rightparen"
        ],
        [
          "regex",
          [
            "quote",
            "^\\)[;:]?"
          ]
        ]
      ],
      [
        [
          "quote",
          "leftbrace"
        ],
        [
          "regex",
          [
            "quote",
            "^\\{"
          ]
        ]
      ],
      [
        [
          "quote",
          "rightbrace"
        ],
        [
          "regex",
          [
            "quote",
            "^\\}"
          ]
        ]
      ],
      [
        [
          "quote",
          "quote"
        ],
        [
          "regex",
          [
            "quote",
            "^`"
          ]
        ]
      ],
      [
        [
          "quote",
          "indent"
        ],
        [
          "regex",
          [
            "quote",
            "^\\n[\\t ]*"
          ]
        ]
      ],
      [
        [
          "quote",
          "string"
        ],
        [
          "regex",
          [
            "quote",
            "^(\"([^\\\\\"]|\\\\\\\\|\\\\\")*\"|'([^\\\\']|\\\\\\\\|\\\\')*')[:]?"
          ]
        ]
      ],
      [
        [
          "quote",
          "regex"
        ],
        [
          "regex",
          [
            "quote",
            "^/([^\\\\\\/]|\\\\\\\\|\\\\\\/)*\\/"
          ]
        ]
      ],
      [
        [
          "quote",
          "callargs"
        ],
        [
          "regex",
          [
            "quote",
            "^[a-zA-Z_?!+\\-/*=\\.]+[:]"
          ]
        ]
      ],
      [
        [
          "quote",
          "call"
        ],
        [
          "regex",
          [
            "quote",
            "^[a-zA-Z_?!+\\-/*=\\.]+[;]"
          ]
        ]
      ],
      [
        [
          "quote",
          "atom"
        ],
        [
          "regex",
          [
            "quote",
            "^[a-zA-Z_?!+\\-/*=\\.]+"
          ]
        ]
      ],
      [
        [
          "quote",
          "comma"
        ],
        [
          "regex",
          [
            "quote",
            "^,"
          ]
        ]
      ],
      [
        [
          "quote",
          "semicolon"
        ],
        [
          "regex",
          [
            "quote",
            "^;"
          ]
        ]
      ],
      [
        [
          "quote",
          "null"
        ],
        [
          "regex",
          [
            "quote",
            "^null"
          ]
        ]
      ],
      [
        [
          "quote",
          "bool"
        ],
        [
          "regex",
          [
            "quote",
            "^true|^false"
          ]
        ]
      ],
      [
        [
          "quote",
          "number"
        ],
        [
          "regex",
          [
            "quote",
            "^[0-9+]+"
          ]
        ]
      ],
      [
        [
          "quote",
          "comment"
        ],
        [
          "regex",
          [
            "quote",
            "^\\#[^\\n]+"
          ]
        ]
      ]
    ]
  ],
  [
    "=",
    "cleanReturns",
    [
      "fn",
      [
        "list",
        "str"
      ],
      [
        "call",
        "str",
        [
          "quote",
          "replace"
        ],
        [
          "regex",
          [
            "quote",
            "^[\\t ]+"
          ]
        ],
        [
          "quote",
          ""
        ]
      ]
    ]
  ],
  [
    "=",
    "tokenize",
    [
      "fn",
      [
        "list",
        "code"
      ],
      [
        "loop",
        [
          "list",
          "code",
          [
            "=",
            "tokens",
            [
              "list"
            ]
          ]
        ],
        [
          "=",
          [
            "list",
            "patt",
            "k"
          ],
          [
            "first",
            [
              "reduce",
              [
                "fn",
                [
                  "list",
                  "patt",
                  "k"
                ],
                [
                  "call",
                  "patt",
                  [
                    "quote",
                    "test"
                  ],
                  "code"
                ]
              ],
              "chunker"
            ]
          ]
        ],
        [
          "=",
          [
            "list",
            "token"
          ],
          [
            "call",
            "patt",
            [
              "quote",
              "exec"
            ],
            "code"
          ]
        ],
        [
          "=",
          "tokens2",
          [
            "concat",
            "tokens",
            [
              "list",
              "k",
              "token"
            ]
          ]
        ],
        [
          "if",
          [
            ">",
            [
              ".",
              "code",
              [
                "quote",
                "length"
              ]
            ],
            [
              ".",
              "token",
              [
                "quote",
                "length"
              ]
            ]
          ],
          [
            "continue",
            [
              "call",
              [
                "call",
                "code",
                [
                  "quote",
                  "substr"
                ],
                [
                  ".",
                  "token",
                  [
                    "quote",
                    "length"
                  ]
                ]
              ],
              [
                "quote",
                "replace"
              ],
              [
                "regex",
                [
                  "quote",
                  "^[\\t ]+"
                ]
              ],
              [
                "quote",
                ""
              ]
            ],
            "tokens2"
          ],
          "tokens2"
        ]
      ]
    ]
  ],
  [
    "=",
    "tokenInner",
    [
      "fn",
      [
        "list",
        "c2",
        "chunker",
        "tokens"
      ],
      [
        "loop",
        [
          "list",
          [
            "=",
            "mylist",
            [
              "pairs",
              "chunker"
            ]
          ]
        ],
        [
          "=",
          "item",
          [
            "first",
            "mylist"
          ]
        ],
        [
          "=",
          "k",
          [
            "first",
            "item"
          ]
        ],
        [
          "=",
          "patt",
          [
            "first",
            [
              "rest",
              "item"
            ]
          ]
        ],
        [
          "if",
          [
            "=",
            "m",
            [
              "call",
              "patt",
              [
                "quote",
                "exec"
              ],
              "c2"
            ]
          ],
          [
            "do",
            [
              "fn",
              [
                "list"
              ],
              [
                "=",
                "token",
                [
                  "first",
                  "m"
                ]
              ],
              [
                "=",
                "c3",
                [
                  "call",
                  "c2",
                  [
                    "quote",
                    "substr"
                  ],
                  [
                    ".",
                    "token",
                    [
                      "quote",
                      "length"
                    ]
                  ]
                ]
              ],
              [
                "=",
                "c4",
                [
                  "call",
                  "c3",
                  [
                    "quote",
                    "replace"
                  ],
                  [
                    "regex",
                    [
                      "quote",
                      "^[\\t ]+"
                    ]
                  ],
                  [
                    "quote",
                    ""
                  ]
                ]
              ],
              [
                "call",
                "tokens",
                [
                  "quote",
                  "push"
                ],
                [
                  "list",
                  "k",
                  "token"
                ]
              ],
              [
                "list",
                "m",
                "c4"
              ]
            ]
          ],
          [
            "if",
            [
              "first",
              [
                "rest",
                "mylist"
              ]
            ],
            [
              "continue",
              [
                "rest",
                "mylist"
              ]
            ],
            [
              "throw",
              [
                "new",
                "Error",
                [
                  "quote",
                  "Invalid Code"
                ]
              ]
            ]
          ]
        ]
      ]
    ]
  ],
  [
    "=",
    "parse",
    [
      "fn",
      [
        "list",
        "code"
      ],
      [
        "=",
        "tokens",
        [
          "tokenize",
          "code"
        ]
      ],
      [
        "=",
        "i",
        0
      ],
      [
        "=",
        "res",
        [
          "list"
        ]
      ],
      [
        "=",
        "stack",
        [
          "list",
          [
            "list",
            "res",
            "-1"
          ]
        ]
      ],
      [
        "=",
        "indent",
        0
      ],
      [
        "=",
        "at",
        [
          "fn",
          [
            "list",
            "type"
          ],
          [
            "if",
            "tokens",
            [
              "list",
              "i"
            ],
            "tokens",
            [
              "list",
              "i"
            ],
            [
              "==",
              [
                "list",
                0
              ],
              "type"
            ],
            "false"
          ]
        ]
      ],
      [
        "=",
        "peek",
        [
          "fn",
          [
            "list",
            "type"
          ],
          [
            "if",
            "tokens",
            [
              "list",
              [
                "+",
                "i",
                1
              ]
            ],
            "tokens",
            [
              "list",
              [
                "+",
                "i",
                1
              ]
            ],
            [
              "==",
              [
                "list",
                0
              ],
              "type"
            ],
            "false"
          ]
        ]
      ],
      [
        "=",
        "next",
        [
          "fn",
          [
            "list"
          ],
          [
            "=",
            "i",
            [
              "+",
              "i",
              1
            ]
          ],
          "tokens",
          [
            "list",
            [
              "-",
              "i",
              1
            ]
          ]
        ]
      ],
      [
        "=",
        "top",
        [
          "fn",
          [
            "list"
          ],
          [
            "if",
            "stack",
            [
              "list",
              [
                "-",
                [
                  ".",
                  "stack",
                  [
                    "quote",
                    "length"
                  ]
                ],
                1
              ]
            ],
            "stack",
            [
              "list",
              [
                "-",
                [
                  ".",
                  "stack",
                  [
                    "quote",
                    "length"
                  ]
                ],
                1
              ]
            ],
            [
              "list",
              0
            ],
            "false"
          ]
        ]
      ]
    ]
  ]
]
